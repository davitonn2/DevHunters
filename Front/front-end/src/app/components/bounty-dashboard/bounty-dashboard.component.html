<div class="dashboard-container">
  <div class="header">
    <div class="header-left">
      <h1>ğŸ¯ DevHunter - Bounty Dashboard</h1>
      <button (click)="loadBounties()" class="refresh-btn">ğŸ”„ Atualizar</button>
    </div>

    <!-- SeÃ§Ã£o de Info do UsuÃ¡rio adicionada aqui -->
    <div class="user-info" *ngIf="currentUser">
      <span class="user-name">{{ currentUser.name }}</span>
      <span *ngIf="currentUser?.balance != null" class="user-xp"> {{ currentUser?.balance | currency:'BRL'}}</span>
      <span class="user-role">[{{ currentUser.role }}]</span>
    </div>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="loading" class="loading">
    Carregando bounties...
  </div>

  <div *ngIf="!loading && bounties.length === 0" class="empty-state">
    <p>Nenhuma bounty aberta no momento. ğŸ‰</p>
  </div>
  <div class="bounties-grid" *ngIf="!loading">
    <!-- Open bounties -->
    <h2 *ngIf="bounties.length>0">Bounties Abertas</h2>
    <div *ngFor="let bounty of bounties" class="bounty-card">
      <div class="bounty-header">
        <h3>{{ bounty.title }}</h3>
        <span class="xp-badge">+{{ bounty.rewardValue | currency:'BRL' }} </span>
      </div>
      <p class="bounty-description">{{ bounty.description }}</p>
      <div class="bounty-meta">
        <small *ngIf="bounty.createdBy">Criado por: {{ bounty.createdBy?.name }}</small>
        <small *ngIf="bounty.hunter">Hunter: {{ bounty.hunter?.name }}</small>
        <small *ngIf="bounty.pendingHunter">Interesse pendente: {{ bounty.pendingHunter?.name }}</small>
      </div>
      <div class="bounty-status">
        <span class="status-badge" [class]="statusClass(bounty.status)">
          {{ bounty.status }}
        </span>
      </div>

      <div class="bounty-actions">
        <!-- BotÃ£o para Hunter reivindicar -->
        <button
          *ngIf="canClaim(bounty)"
          (click)="claimBounty(bounty.id!)"
          class="btn btn-primary">
          ğŸ¯ Manifestar interesse
        </button>

        <!-- BotÃ£o para Master aprovar Hunter -->
        <button
          *ngIf="canApprove(bounty)"
          (click)="approveClaim(bounty.id!)"
          class="btn btn-secondary">
          âœ… Aprovar Hunter
        </button>

        <!-- BotÃ£o para Hunter entregar -->
        <button
          *ngIf="canSubmit(bounty)"
          (click)="submitBounty(bounty.id!)"
          class="btn btn-success">
          âœ… Entregar
        </button>

        <!-- NOVO BOTÃƒO: Master finaliza e paga XP -->
        <button
          *ngIf="canComplete(bounty)"
          (click)="completeBounty(bounty.id!)"
          class="btn btn-success">
          ğŸ† Finalizar Bounty
        </button>

        <!-- BotÃ£o para Master deletar -->
        <button
          *ngIf="canDelete(bounty)"
          (click)="deleteBounty(bounty.id!)"
          class="btn btn-danger">
          ğŸ—‘ï¸ Deletar
        </button>
      </div>
    </div>
    <!-- Pending / in-progress / awaiting review (side-by-side layout) -->
    <h2 *ngIf="pendingBounties.length>0" style="grid-column: 1 / -1;">Pendentes / Em Andamento / Em RevisÃ£o</h2>
    <div *ngFor="let bounty of pendingBounties" class="bounty-card pending">
        <div class="bounty-header">
          <h3>{{ bounty.title }}</h3>
          <span class="xp-badge">+{{ bounty.rewardValue | currency:'BRL' }} </span>
        </div>
        <p class="bounty-description">{{ bounty.description }}</p>
        <div class="bounty-meta">
          <small *ngIf="bounty.createdBy">Criado por: {{ bounty.createdBy?.name }}</small>
          <small *ngIf="bounty.hunter">Hunter: {{ bounty.hunter?.name }}</small>
          <small *ngIf="bounty.pendingHunter">Interesse pendente: {{ bounty.pendingHunter?.name }}</small>
        </div>
        <div class="bounty-status">
          <span class="status-badge" [class]="statusClass(bounty.status)">
            {{ bounty.status }}
          </span>
        </div>
        <div class="bounty-actions">
          <button *ngIf="canApprove(bounty)" (click)="approveClaim(bounty.id!)" class="btn btn-secondary">âœ… Aprovar Hunter</button>
          <button *ngIf="currentUser?.role==='MASTER' && bounty.status==='AGUARDANDO_APROVACAO'" (click)="rejectClaim(bounty.id!)" class="btn btn-warning">âŒ Recusar</button>
          <button *ngIf="canSubmit(bounty)" (click)="submitBounty(bounty.id!)" class="btn btn-success">âœ… Entregar</button>
          <button *ngIf="canComplete(bounty)" (click)="completeBounty(bounty.id!)" class="btn btn-success">ğŸ† Finalizar Bounty</button>
          <button *ngIf="canDelete(bounty)" (click)="deleteBounty(bounty.id!)" class="btn btn-danger">ğŸ—‘ï¸ Deletar</button>
        </div>
      </div>
  </div>
</div>
